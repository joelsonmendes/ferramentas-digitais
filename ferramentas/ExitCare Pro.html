<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExitCare Pro | Dashboard Moderno com Dark Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* ================================================= */
        /* 1. PALETA DE CORES E DARK MODE VARI√ÅVEIS           */
        /* ================================================= */
        :root {
            /* LIGHT MODE (Padr√£o) */
            --primary-color: #007bff; /* Azul vibrante */
            --secondary-color: #ffc107; /* Amarelo/Laranja */
            --accent-color: #28a745; /* Verde (Success) */
            --danger-color: #dc3545; /* Vermelho */
            --info-color: #17a2b8; /* Ciano */
            
            --bg-main: #f0f2f5; 
            --bg-light: #e9ecef; 
            --text-dark: #343a40; 
            --text-light: #ffffff;
            --card-bg: #ffffff;
            --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            --border-radius: 0.5rem;
        }

        .dark-mode {
            /* DARK MODE */
            --primary-color: #6a92ed; 
            --secondary-color: #f7d16a; 
            --accent-color: #5cb85c; 
            --danger-color: #e37e86; 
            --info-color: #6ddde8; 
            
            --bg-main: #212529; 
            --bg-light: #343a40; 
            --text-dark: #e9ecef; 
            --card-bg: #2b3035; 
            --shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.4);
        }

        /* ================================================= */
        /* 2. BASE E LAYOUT (ESPA√áAMENTO)                    */
        /* ================================================= */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-main); 
            color: var(--text-dark);
            line-height: 1.6;
            transition: background-color 0.5s, color 0.5s;
        }

        header {
            background-color: var(--card-bg);
            color: var(--text-dark);
            padding: 15px 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--bg-light);
            transition: background-color 0.5s, color 0.5s;
        }

        header h1 { 
            margin: 0; 
            font-size: 1.8em; 
            font-weight: 700; 
            color: var(--primary-color);
            transition: all 0.3s; 
        }
        header .right-controls { 
            display: flex; 
            align-items: center; 
        }

        .dashboard-container {
            display: flex;
            max-width: 1600px; 
            margin: 40px auto; 
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: none; 
        }

        /* ---------------- Sidebar (Abas Estrat√©gicas) ---------------- */
        .sidebar {
            width: 280px; 
            background-color: var(--card-bg);
            padding: 30px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            flex-shrink: 0;
            margin-right: 30px; 
            transition: background-color 0.5s, box-shadow 0.5s;
        }

        .tab-button {
            display: flex;
            align-items: center;
            padding: 18px 30px; 
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 400;
            color: var(--text-dark);
            transition: all 0.3s;
            width: 100%;
        }

        .tab-button i, .tab-button span:first-child {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .tab-button:hover {
            background-color: var(--bg-light);
            color: var(--primary-color);
        }

        .tab-button.active {
            background-color: var(--bg-light); 
            color: var(--primary-color);
            font-weight: 600;
            border-left: 5px solid var(--primary-color); 
        }
        
        /* ---------------- Conte√∫do Principal ---------------- */
        .content {
            flex-grow: 1;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
            background-color: var(--card-bg);
            padding: 40px; 
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: background-color 0.5s, box-shadow 0.5s;
        }

        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Card Style */
        .card {
            background-color: var(--bg-light); 
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            transition: background-color 0.5s;
        }
        
        /* Bot√µes */
        button.primary {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: var(--shadow);
        }

        button.primary:hover {
            background-color: #0056b3; 
            transform: translateY(-2px);
        }
        
        /* Bot√£o de Toggle Dark Mode e Novos Bot√µes do Header */
        .toggle-button {
            background: var(--bg-light);
            color: var(--text-dark);
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-left: 15px;
            transition: all 0.3s;
            font-size: 1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .toggle-button:hover {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        
        /* NOVO: Efeito de escuta para o bot√£o de comando de voz */
        .listening {
            background-color: var(--danger-color) !important;
            color: var(--text-light) !important;
            animation: pulse-microphone 1.5s infinite;
        }

        @keyframes pulse-microphone {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        /* Checklist, KPI Grid, etc. */
        .checklist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .checklist-item {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--primary-color); 
            transition: all 0.3s;
        }
        .checklist-item.status-concluido { border-left-color: var(--accent-color); }
        .checklist-item.status-pendente { border-left-color: var(--danger-color); }
        .status-badge.status-concluido { background-color: var(--accent-color); color: var(--text-light); }
        .status-badge.status-andamento { background-color: var(--secondary-color); color: var(--text-light); }
        .status-badge.status-pendente { background-color: var(--danger-color); color: var(--text-light); }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-box {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: left;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .kpi-value-large {
            font-size: 2.8em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .ti-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Efeito de alerta para TI */
        .ti-alert-blocker {
            background-color: rgba(220, 53, 69, 0.08);
            border: 3px dashed var(--danger-color);
            padding: 20px;
            border-radius: var(--border-radius);
            animation: pulse-red 1.5s infinite alternate;
        }
        
        @keyframes pulse-red {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        .charts-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .pie-chart-sim {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary-color) 0% 45%, 
                var(--secondary-color) 45% 70%, 
                var(--accent-color) 70% 100% 
            );
            margin: 20px auto;
        }
        
        .chart-dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; 
            gap: 20px;
            margin-top: 30px;
        }

        .large-chart-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Estilos do Chatbot */
        #chat-window {
            height: 400px;
            border: 1px solid var(--bg-light);
            border-radius: var(--border-radius);
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 20px;
            background-color: var(--bg-light);
            transition: background-color 0.5s, border-color 0.5s;
        }
        .dark-mode #chat-window {
             border-color: var(--bg-light);
             background-color: var(--bg-light);
        }
        
        .chat-message-ai span {
            background-color: var(--card-bg) !important;
            color: var(--text-dark) !important;
            border: 1px solid var(--info-color);
            font-weight: 400 !important;
        }
        
        .chat-message-user span {
            background-color: var(--primary-color) !important;
            color: var(--text-light) !important;
        }
        
        /* NOVO: Estilos para os bot√µes de Sugest√£o R√°pida no Chat */
        .quick-reply-btn {
            background-color: var(--bg-light); 
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .dark-mode .quick-reply-btn {
            background-color: var(--bg-light);
            color: var(--primary-color);
        }
        .dark-mode .quick-reply-btn:hover {
            background-color: var(--primary-color);
            color: var(--text-light);
        }


        /* Media Queries para Mobile (Menos apertado) */
        @media (max-width: 900px) {
            .dashboard-container {
                flex-direction: column;
                margin: 20px;
            }
            .sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 20px;
                padding: 10px;
                display: flex;
                overflow-x: auto;
                white-space: nowrap;
                border-radius: var(--border-radius);
            }
            .tab-button {
                flex-shrink: 0;
                padding: 10px 15px;
                text-align: center;
                border-bottom: 3px solid transparent;
                border-left: none !important;
            }
            .tab-button.active {
                border-bottom: 3px solid var(--primary-color);
                border-left: none !important;
            }
            .tab-content {
                padding: 20px;
            }
            .kpi-grid, .ti-grid, .charts-area, .chart-dashboard-grid, .large-chart-area {
                grid-template-columns: 1fr; 
            }
        }
        
    </style>
</head>
<body>

<audio id="alertSound" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-software-notification-2.mp3" type="audio/mpeg">
</audio>

<div id="login-screen" style="
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--primary-color); 
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    flex-direction: column;
    color: white;
    font-family: 'Roboto', sans-serif;
">
    <div style="
        background-color: var(--card-bg); 
        padding: 40px; 
        border-radius: var(--border-radius); 
        box-shadow: var(--shadow); 
        width: 350px; 
        max-width: 90%; 
        text-align: center;
    ">
        <h2 style="color: var(--primary-color); margin-top: 0;"><i class="fas fa-lock"></i> ExitCare Pro | Acesso RH</h2>
        <p style="color: var(--text-dark); margin-bottom: 25px;">Use as credenciais de demonstra√ß√£o para entrar.</p>
        
        <input type="text" id="username-input" placeholder="Usu√°rio (Ex: RH.admin)" value="RH.admin" style="
            margin-bottom: 15px; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            width: 100%; 
            box-sizing: border-box; 
            font-size: 1em;
        ">
        
        <input type="password" id="password-input" placeholder="Senha (Ex: demo123)" value="demo123" style="
            margin-bottom: 20px; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            width: 100%; 
            box-sizing: border-box; 
            font-size: 1em;
        ">
        
        <button class="primary" onclick="login()" style="
            width: 100%; 
            padding: 12px; 
            background-color: var(--primary-color); 
            border: none;
        ">
            <i class="fas fa-sign-in-alt"></i> Entrar no Dashboard
        </button>
        
        <p id="login-error" style="color: var(--danger-color); margin-top: 15px; font-weight: 600; display: none;">
            Credenciais Inv√°lidas! Tente novamente.
        </p>
    </div>
</div>


<header>
    <h1>ExitCare Pro <i class="fas fa-heart-crack" style="color: var(--danger-color);"></i> | Gest√£o de Offboarding</h1>
    <div class="right-controls">
        <div style="font-weight: 600; margin-right: 15px; color: var(--text-dark);">Time de RH</div>
        
        <button class="toggle-button" id="voice-command-button" onclick="startVoiceCommand()" title="Comando de Voz">
            <i class="fas fa-microphone" id="voice-icon"></i>
        </button>
        
        <button class="toggle-button" onclick="showLoginScreen()" title="Sair do Sistema">
            <i class="fas fa-sign-out-alt"></i> 
        </button>
        
        <button class="toggle-button" onclick="toggleDarkMode()">
            <i class="fas fa-sun" id="mode-icon"></i>
        </button>
    </div>
</header>

<div class="dashboard-container">
    <div class="sidebar">
        <button class="tab-button active" onclick="openTab(event, 'checklist')"><span>üìù</span> Checklist Operacional</button>
        <button class="tab-button" onclick="openTab(event, 'chat-ia')"><span>ü§ñ</span> ExitCare IA Chat</button> 
        <button class="tab-button" onclick="openTab(event, 'roteiro')"><span>üó£Ô∏è</span> Roteiro Emp√°tico</button>
        <button class="tab-button" onclick="openTab(event, 'documentos')"><span>‚úçÔ∏è</span> Documentos Legais</button>
        <button class="tab-button" onclick="openTab(event, 'ti-integracao')"><span>üõ°Ô∏è</span> TI - Desligamento T√©cnico</button>
        <button class="tab-button" onclick="openTabWithSound(event, 'pesquisa')"><span>üìä</span> Pesquisa de Sa√≠da</button>
        <button class="tab-button" onclick="openTabWithSound(event, 'indicadores')"><span>üöÄ</span> Painel com Indicadores</button>
    </div>

    <div class="content">

        <div id="checklist" class="tab-content active">
            
            <div id="checklist-config">
                <h2><i class="fas fa-user-minus"></i> Configura√ß√£o do Desligamento</h2>
                
                <div class="card">
                    <div class="form-group">
                        <label for="colaboradora-nome"><i class="fas fa-user-tag"></i> Colaboradora Desligada:</label>
                        <input type="text" id="colaboradora-nome" placeholder="Ex: Juliana Santos" value="Juliana Santos">
                    </div>

                    <div class="form-group">
                        <label for="tipo-demissao"><i class="fas fa-handshake-slash"></i> Tipo de Desligamento:</label>
                        <select id="tipo-demissao" onchange="generateChecklist(false, true)"> 
                            <option value="performance">Performance/Decis√£o da Empresa (Com Aviso)</option>
                            <option value="voluntario">Pedido do Funcion√°rio (Volunt√°rio)</option>
                            <option value="justa">Justa Causa (Bloqueio Imediato)</option>
                        </select>
                    </div>
                    
                    <button class="primary" onclick="generateChecklist()"><i class="fas fa-cogs"></i> Gerar Checklist e Prazos</button>
                </div>
            </div>

            <div id="checklist-tasks-area" style="display: none; opacity: 0;">
                <h2><i class="fas fa-list-check"></i> Checklist Gerado</h2>
                <h3 style="margin-top: 30px; color: var(--text-dark);">Tarefas Geradas Automatizadas:</h3>
                <div class="checklist-grid" id="checklist-tasks">
                    </div>
                
                <button class="primary" style="margin-top: 30px; background-color: var(--secondary-color);" onclick="showChecklistConfig()"><i class="fas fa-angle-left"></i> Voltar √† Configura√ß√£o</button>
            </div>
        </div>
        
        <div id="chat-ia" class="tab-content">
            <h2><i class="fas fa-robot"></i> ExitCare IA Chat</h2>
            <p>Seu assistente virtual para d√∫vidas sobre offboarding, prazos e legisla√ß√£o.</p>

            <div id="quick-replies" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
                <button class="quick-reply-btn" onclick="quickReply('Qual o prazo para pagamento da rescis√£o?')"><i class="fas fa-clock"></i> Prazo Rescis√£o</button>
                <button class="quick-reply-btn" onclick="quickReply('Como gerar o checklist de TI?')"><i class="fas fa-shield-alt"></i> Checklist TI</button>
                <button class="quick-reply-btn" onclick="quickReply('Onde gero a Carta de Recomenda√ß√£o?')"><i class="fas fa-file-export"></i> Documentos</button>
                <button class="quick-reply-btn" onclick="quickReply('O que fazer em caso de Justa Causa?')"><i class="fas fa-gavel"></i> Justa Causa</button>
            </div>
            <div id="chat-window" style="
                height: 400px;
                border: 1px solid var(--bg-light);
                border-radius: var(--border-radius);
                padding: 15px;
                overflow-y: auto;
                margin-bottom: 20px;
                background-color: var(--bg-light);
            ">
                </div>

            <div style="display: flex;">
                <input type="text" id="chat-input" placeholder="Pergunte sobre prazos, documentos ou legisla√ß√£o..." 
                    onkeypress="if(event.keyCode == 13) sendChatMessage()" 
                    style="
                    flex-grow: 1; 
                    padding: 12px; 
                    border: 1px solid #ddd; 
                    border-radius: 8px 0 0 8px; 
                    font-size: 1em;
                    background-color: var(--card-bg);
                    color: var(--text-dark);
                ">
                <button class="primary" onclick="sendChatMessage()" style="
                    border-radius: 0 8px 8px 0; 
                    padding: 12px 20px;
                    box-shadow: none;
                ">
                    <i class="fas fa-paper-plane"></i> Enviar
                </button>
            </div>
        </div>
        <div id="roteiro" class="tab-content">
            <h2><i class="fas fa-user-tie"></i> Roteiro de Conversa Emp√°tica</h2>
            
            <div class="card" style="border-left: 5px solid var(--secondary-color);">
                <p><strong><i class="fas fa-calendar-alt"></i> Data da Conversa Prevista:</strong> <span id="data-conversa-prevista" style="font-weight: 700;"></span></p>
                <p><strong><i class="fas fa-exclamation-triangle"></i> Aten√ß√£o Gestor:</strong> Seja claro, direto e demonstre gratid√£o pela contribui√ß√£o.</p>
            </div>

            <div class="card">
                <h3><i class="fas fa-comment-dots"></i> Passo 1: In√≠cio e Not√≠cia</h3>
                <p>Mantenha a calma e v√° direto ao ponto. Use uma linguagem de decis√£o, n√£o de culpa.</p>
                <div style="background-color: var(--primary-color); color: white; padding: 15px; border-radius: 8px; margin-top: 15px; font-style: italic;">
                    "Ap√≥s uma an√°lise cuidadosa, a empresa decidiu pelo encerramento de sua jornada aqui. Quero expressar nossa gratid√£o pelo seu tempo e dedica√ß√£o, especialmente em [mencionar conquista]."
                </div>
            </div>

            <div class="card" style="background-color: rgba(255, 193, 7, 0.1);">
                <h3><i class="fas fa-gavel"></i> O que Evitar (Regras de Ouro)</h3>
                <ul>
                    <li>**Nunca Diga:** "Voc√™ n√£o servia" ou "A culpa √© do fulano."</li>
                    <li>**Foque no Fato:** Mantenha o foco na decis√£o da empresa, n√£o em erros pessoais.</li>
                </ul>
            </div>
            
            <div class="card" style="text-align: center;">
                <p>Recurso de Apoio (V√≠deo Curto para Prepara√ß√£o)</p>
                <a href="https://www.youtube.com/watch?v=hgOemtTAq1I" target="_blank" class="primary" style="text-decoration: none; display: inline-block; background-color: var(--info-color);"><i class="fas fa-video"></i> Assista ao Treinamento Empatia (2 min)</a>
            </div>
        </div>

        <div id="documentos" class="tab-content">
            <h2><i class="fas fa-file-contract"></i> Gera√ß√£o de Documentos Legais</h2>

            <div class="card">
                <div class="form-group">
                    <label for="nome-documento"><i class="fas fa-keyboard"></i> Nome da Colaboradora para Documento:</label>
                    <input type="text" id="nome-documento" placeholder="Digite o nome completo" value="Maria Eduarda Costa">
                </div>

                <button class="primary" onclick="generateDocument('rescisao')"><i class="fas fa-magic"></i> Gerar e Assinar Eletronicamente (Termo de Rescis√£o)</button>
                
                <hr style="margin: 25px 0; border-color: var(--bg-light);">
                
                <h3 style="margin-top: 0; color: var(--text-dark);"><i class="fas fa-award"></i> Op√ß√£o: Carta de Recomenda√ß√£o</h3>
                <p style="font-size: 0.9em; margin-bottom: 15px;">Gere a Carta de Recomenda√ß√£o apenas para desligamentos volunt√°rios ou por performance positiva.</p>
                
                <div class="form-group">
                    <label for="recommender-name"><i class="fas fa-user-circle"></i> Nome do Signat√°rio (RH/Gestor):</label>
                    <input type="text" id="recommender-name" placeholder="Ex: Ana Maria, Gerente de RH" value="Carlos Silva, Gerente de RH">
                </div>
                <div class="form-group">
                    <label for="performance-rating"><i class="fas fa-star"></i> Avalia√ß√£o de Desempenho (para a carta):</label>
                    <select id="performance-rating">
                        <option value="excelente">Excelente Desempenho (Recomenda√ß√£o Forte)</option>
                        <option value="bom" selected>Bom Desempenho (Recomenda√ß√£o Padr√£o)</option>
                        <option value="neutro">Neutro (Recomenda√ß√£o Formal)</option>
                    </select>
                </div>
                
                <button class="primary" style="background-color: var(--accent-color);" onclick="generateDocument('recomendacao')"><i class="fas fa-scroll"></i> Gerar Carta de Recomenda√ß√£o</button>
            </div>
            
            <div class="legal-alert">
                <i class="fas fa-calendar-times"></i> **ALERTA LEGAL:** Prazo final para pagamento da Rescis√£o: **<span id="data-pagamento-prevista"></span>**
            </div>

            <h3 style="margin-top: 30px; color: var(--text-dark);">Pr√©-visualiza√ß√£o do Documento:</h3>
            <div id="document-preview-area" class="document-preview">
                </div>
        </div>

        <div id="ti-integracao" class="tab-content">
            <h2><i class="fas fa-shield-halved"></i> Desligamento T√©cnico e Seguran√ßa de Dados</h2>
            <p>Notifica√ß√£o autom√°tica enviada √† equipe de TI. Acompanhe o status de bloqueio dos sistemas e a devolu√ß√£o de ativos.</p>

            <div class="ti-grid">
                <div class="ti-card" style="border-top: 6px solid var(--danger-color);">
                    <h3 style="color: var(--danger-color); margin-top: 0; display: flex; align-items: center;"><i class="fas fa-lock" style="margin-right: 10px;"></i> Bloqueio de Sistemas</h3>
                    <p style="font-weight: 600; background-color: var(--bg-light); padding: 5px; border-radius: 4px;">Data/Hora Limite: <span id="data-bloqueio-ti" style="color: var(--danger-color);"></span></p>

                    <div id="system-access-list" class="ti-alert-blocker">
                        <div class="system-status"><span><i class="fas fa-user-lock"></i> Acesso Email/Drive</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
                        <div class="system-status"><span><i class="fas fa-users-cog"></i> Acesso CRM/ERP</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
                        <div class="system-status"><span><i class="fas fa-code-branch"></i> Acesso Code Repo</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
                    </div>
                    
                    <button class="primary" style="background-color: var(--danger-color); margin-top: 15px; animation: pulse-red 1s infinite alternate;" onclick="simulateBlocking()"><i class="fas fa-check"></i> SIMULAR BLOQUEIO IMEDIATO</button>
                </div>

                <div class="ti-card">
                    <h3 style="color: var(--accent-color); margin-top: 0; display: flex; align-items: center;"><i class="fas fa-laptop" style="margin-right: 10px;"></i> Devolu√ß√£o de Ativos</h3>
                    <p style="font-weight: 600;">Colaboradora: Juliana Santos</p>

                    <div id="equipment-devolution-list">
                        <div class="devolution-item">
                            <span><i class="fas fa-desktop"></i> Notebook (Serial: XA987)</span>
                            <i class="fas fa-times-circle" style="color: var(--danger-color);" onclick="toggleDevolutionStatus(this, 'pendente')"></i>
                        </div>
                        <div class="devolution-item">
                            <span><i class="fas fa-mobile-alt"></i> Celular Corporativo</span>
                            <i class="fas fa-check-circle" style="color: var(--accent-color);" onclick="toggleDevolutionStatus(this, 'concluido')"></i>
                        </div>
                        <div class="devolution-item">
                            <span><i class="fas fa-credit-card"></i> Crach√°/Acesso</span>
                            <i class="fas fa-times-circle" style="color: var(--danger-color);" onclick="toggleDevolutionStatus(this, 'pendente')"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="pesquisa" class="tab-content">
            <h2><i class="fas fa-chart-pie"></i> Pesquisa de Sa√≠da e An√°lise de Padr√µes</h2>
            <p>Interaja com o formul√°rio abaixo para ver a atualiza√ß√£o dos gr√°ficos em tempo real, simulando novos dados de desligamento!</p>
            
            <hr style="border-color: var(--bg-light);">
            
            <div class="card" style="border-left: 5px solid var(--secondary-color);">
                <h3><i class="fas fa-poll"></i> Simula√ß√£o de Feedback (Juliana Santos)</h3>
                
                <div class="form-group">
                    <label>1. Como voc√™ avalia sua experi√™ncia geral na empresa (de 1 a 5)?</label>
                    <div class="rating-group">
                        <label for="exp_1"><input type="radio" name="exp_geral" id="exp_1" value="1" onchange="updateCharts()">1 <i class="far fa-frown"></i></label>
                        <label for="exp_3"><input type="radio" name="exp_3" id="exp_3" value="3" onchange="updateCharts()">3 <i class="far fa-meh"></i></label>
                        <label for="exp_5"><input type="radio" name="exp_geral" id="exp_5" value="5" onchange="updateCharts()" checked>5 <i class="far fa-smile-beam"></i></label>
                    </div>
                </div>

                <div class="form-group">
                    <label>2. Seu desligamento foi motivado por problemas com a lideran√ßa?</label>
                    <div class="rating-group">
                        <label for="lider_sim"><input type="radio" name="motivo_lideranca" id="lider_sim" value="sim" onchange="updateCharts()">Sim <i class="fas fa-user-slash"></i></label>
                        <label for="lider_nao"><input type="radio" name="motivo_lideranca" id="lider_nao" value="nao" onchange="updateCharts()" checked>N√£o <i class="fas fa-check"></i></label>
                    </div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px; color: var(--text-dark);">An√°lise Inteligente e Indicadores</h3>
            <div class="charts-area">
                
                <div class="card" style="border-left: 5px solid var(--primary-color);">
                    <h4><i class="fas fa-star-half-alt"></i> N√≠vel de Satisfa√ß√£o Geral (M√©dia)</h4>
                    <div class="bar-chart-visual">
                        <div id="bar-satisfacao" class="bar-fill" style="width: 70%; background-color: var(--primary-color);">3.5</div>
                    </div>
                    <p style="font-size: 0.9em; margin: 5px 0;">Tend√™ncia: <span id="current-avg" style="font-weight: 700;">3.5</span></p>
                </div>
                
                <div class="card" style="border-left: 5px solid var(--secondary-color);">
                    <h4><i class="fas fa-bullseye"></i> Foco dos Motivos de Sa√≠da</h4>
                    <div id="pie-chart-area" class="pie-chart-sim"></div>
                    <div style="font-size: 0.9em; text-align: left; padding-left: 20px;">
                        <p style="color: var(--primary-color); margin: 3px 0;">‚ñ† Remunera√ß√£o/Benef√≠cios</p>
                        <p style="color: var(--secondary-color); margin: 3px 0;">‚ñ† Lideran√ßa/Gestor</p>
                        <p style="color: var(--accent-color); margin: 3px 0;">‚ñ† Cultura/Clima</p>
                    </div>
                </div>

                <div class="card" style="border-left: 5px solid var(--danger-color);">
                    <h4><i class="fab fa-google"></i> Alerta de Reputa√ß√£o (Glassdoor)</h4>
                    <div class="kpi-value-large" style="font-size: 3em; color: var(--danger-color);">+15%</div>
                    <p style="font-size: 0.9em; margin: 5px 0; color: var(--danger-color); font-weight: 600;">Aumento de cr√≠ticas negativas (A√ß√£o Imediata)</p>
                </div>
            </div>
        </div>
        
        <div id="indicadores" class="tab-content">
            <h2><i class="fas fa-gauge-high"></i> Vis√£o Estrat√©gica: Painel de Indicadores RH</h2>
            <p style="margin-bottom: 30px; font-weight: 600;">Monitoramento de Offboarding: Identifique tend√™ncias e previna crises de reputa√ß√£o.</p>

            <div class="kpi-grid">
                <div class="kpi-box" 
                     id="kpi-turnover-interactive" 
                     onclick="toggleTurnoverRate()" 
                     title="Clique para alternar entre Semanal, Mensal e Anual"
                     style="cursor: pointer;">
                    <div class="kpi-title" id="turnover-title">TAXA DE TURNOVER (SEMANAL)</div>
                    <div class="kpi-value-large" id="turnover-value">0.8%</div>
                    
                    <div class="kpi-turnover-chart">
                        <div id="turnover-bar" class="kpi-turnover-bar" style="width: 80%; background-color: var(--danger-color);"></div>
                    </div>
                    <div class="kpi-subtitle">Meta: 0.5%. Clique para ver a taxa mensal/anual.</div>
                </div>

                <div class="kpi-box" style="border-left: 5px solid var(--accent-color);">
                    <div class="kpi-title">M√©dia de Satisfa√ß√£o (Exit)</div>
                    <div class="kpi-value-large" style="color: var(--accent-color);">3.8 / 5.0</div>
                    <div class="kpi-subtitle">Aumento de 0.2 pontos no trimestre.</div>
                </div>
                <div class="kpi-box" style="border-left: 5px solid var(--danger-color);">
                    <div class="kpi-title">Cr√≠ticas Reputacionais (Glassdoor)</div>
                    <div class="kpi-value-large" style="color: var(--danger-color);">+15%</div>
                    <div class="kpi-subtitle">Aumento de cr√≠ticas ap√≥s 48h do desligamento.</div>
                </div>
                <div class="kpi-box" 
                     id="kpi-exit-cost-interactive" 
                     onclick="toggleExitCostBreakdown()" 
                     title="Clique para ver o detalhamento do custo de sa√≠da"
                     style="cursor: pointer;">
                    <div class="kpi-title" id="exit-cost-title">CUSTO M√âDIO DE SA√çDA (Por Colab.)</div>
                    <div class="kpi-value-large" id="exit-cost-value" style="color: var(--info-color);">R$ 7.850</div>
                    <div class="kpi-subtitle" id="exit-cost-subtitle">Inclui rescis√£o, contrata√ß√£o e tempo de vac√¢ncia. <br> Clique para ver o detalhamento.</div>
                </div>
                <div class="kpi-box" style="border-left: 5px solid var(--primary-color);">
                    <div class="kpi-title">Desligamentos por Decis√£o da Empresa</div>
                    <div class="kpi-value-large" style="color: var(--primary-color);">63</div>
                    <div class="kpi-subtitle">√öltimos 6 meses. Foco em Performance.</div>
                </div>
            </div>

            <div class="chart-dashboard-grid">
                
                <div class="large-chart-area">
                    
                    <div class="card">
                        <h3 style="color: var(--text-dark); margin-top: 0; font-size: 1.2em;"><i class="fas fa-sitemap"></i> Demiss√µes por √Årea (√öltimo M√™s)</h3>
                        <p style="font-size: 0.9em; font-weight: 600;">Vendas e Tecnologia lideram os desligamentos.</p>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Vendas (35%)</div>
                            <div class="sim-bar" style="width: 75%; background-color: var(--danger-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Tecnologia (25%)</div>
                            <div class="sim-bar" style="width: 60%; background-color: var(--primary-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Marketing (15%)</div>
                            <div class="sim-bar" style="width: 35%; background-color: var(--secondary-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="sim-bar" style="width: 25%; background-color: var(--accent-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 style="color: var(--text-dark); margin-top: 0; font-size: 1.2em;"><i class="fas fa-hand-holding-dollar"></i> Principais Causas de Sa√≠da (Anual)</h3>
                        <p style="font-size: 0.9em; font-weight: 600;">Foco na reten√ß√£o e pol√≠tica salarial.</p>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Remunera√ß√£o (45%)</div>
                            <div class="sim-bar" style="width: 80%; background-color: var(--danger-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Falta de Oportunidade (25%)</div>
                            <div class="sim-bar" style="width: 45%; background-color: var(--primary-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Lideran√ßa/Gestor (15%)</div>
                            <div class="sim-bar" style="width: 25%; background-color: var(--secondary-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600;">Performance (10%)</div>
                            <div class="sim-bar" style="width: 15%; background-color: var(--accent-color); height: 18px; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="border-left: 5px solid var(--secondary-color);">
                    <h3 style="color: var(--secondary-color); margin-top: 0; font-size: 1.2em;"><i class="fas fa-trophy"></i> Gestores que Mais Precisam de Apoio</h3>
                    <p style="font-size: 0.9em; margin-bottom: 15px;">Baseado em alto turnover e baixo score de satisfa√ß√£o.</p>
                    
                    <div class="ranking-item">
                        <span><i class="fas fa-user-xmark"></i> **1. Ana Souza (Vendas)**</span>
                        <strong>5 desligamentos</strong>
                    </div>
                    <div class="ranking-item">
                        <span><i class="fas fa-user-xmark"></i> **2. Pedro Lima (Tech)**</span>
                        <strong>4 desligamentos</strong>
                    </div>
                    <div class="ranking-item">
                        <span><i class="fas fa-user-xmark"></i> 3. Carla Matos (Mkt)</span>
                        <span>3 desligamentos</span>
                    </div>
                    <div class="ranking-item">
                        <span><i class="fas fa-user-xmark"></i> 4. Jo√£o Silva (Finan.)</span>
                        <span>2 desligamentos</span>
                    </div>
                    <p style="margin-top: 20px; text-align: center;">
                        <button class="primary" style="background-color: var(--secondary-color); font-size: 0.9em; padding: 10px 15px;" onclick="suggestTraining()"><i class="fas fa-comments"></i> Sugerir Treinamento</button>
                    </p>
                </div>
            </div>
        </div>


    </div>
</div>

<script>
    // --- 0. L√ìGICA DE AUTENTICA√á√ÉO E INICIALIZA√á√ÉO ---
    const VALID_USERNAME = "RH.admin";
    const VALID_PASSWORD = "demo123";
    let isDarkMode = false;
    
    // Altera o modo claro/escuro
    function toggleDarkMode() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode', isDarkMode);
        const icon = document.getElementById('mode-icon');
        icon.classList.remove(isDarkMode ? 'fa-sun' : 'fa-moon');
        icon.classList.add(isDarkMode ? 'fa-moon' : 'fa-sun');
    }

    function initializeDashboard() {
        showChecklistConfig(); 
        generateChecklist(true); 
        updateCharts();
        initialChatWelcome(); // Chamada para iniciar a conversa do chatbot
    }
    
    // Fun√ß√£o para simular o Logoff/Sair
    function showLoginScreen() {
        document.getElementById('login-screen').style.display = 'flex';
        // Opcional: Limpar as credenciais para reentrada
        document.getElementById('username-input').value = 'RH.admin';
        document.getElementById('password-input').value = 'demo123';
    }

    function login() {
        const username = document.getElementById('username-input').value;
        const password = document.getElementById('password-input').value;
        const loginScreen = document.getElementById('login-screen');
        const errorMsg = document.getElementById('login-error');

        if (username === VALID_USERNAME && password === VALID_PASSWORD) {
            loginScreen.style.display = 'none';
            initializeDashboard(); 
        } else {
            errorMsg.style.display = 'block';
            document.getElementById('alertSound').play();
            setTimeout(() => errorMsg.style.display = 'none', 3000); 
        }
    }
    // -----------------------------------------------------------

    // NOVO: Fun√ß√£o para simular Comando de Voz (Visual Action)
    let isListening = false; 

    function startVoiceCommand() {
        if (isListening) return; 

        isListening = true;
        const button = document.getElementById('voice-command-button');
        const icon = document.getElementById('voice-icon');
        const headerTitleElement = document.querySelector('header h1');
        const originalTitleHTML = headerTitleElement.innerHTML; // Salva o HTML original
        
        // 1. Inicia o estado de escuta
        button.classList.add('listening');
        icon.classList.remove('fa-microphone');
        icon.classList.add('fa-dot-circle'); 
        
        // 2. Feedback visual no t√≠tulo (Simula a escuta)
        headerTitleElement.innerHTML = '<span style="color: var(--danger-color); font-weight: 700;">üé§ ESCUTANDO... Diga seu comando.</span>';
        document.getElementById('alertSound').play();

        // 3. Simula o processamento e t√©rmino ap√≥s 3 segundos
        setTimeout(() => {
            // Reverte o estado do bot√£o
            button.classList.remove('listening');
            icon.classList.remove('fa-dot-circle');
            icon.classList.add('fa-microphone');
            
            // A√ß√£o: Simula o reconhecimento do comando "Gerar Checklist"
            const recognizedCommand = "Gerar checklist para Juliana Santos";
            
            // 4. Feedback visual de A√ß√£o no t√≠tulo
            headerTitleElement.innerHTML = `<span style="color: var(--accent-color); font-weight: 700;"><i class="fas fa-check"></i> COMANDO RECONHECIDO: ${recognizedCommand}</span>`;
            
            // Executa a fun√ß√£o do checklist (como se fosse o comando)
            generateChecklist(false, false); 
            // openTab(null, 'checklist'); // N√£o precisa do evento para abrir a tab

            // Reverte o t√≠tulo ap√≥s 2 segundos
            setTimeout(() => {
                 headerTitleElement.innerHTML = originalTitleHTML;
                 isListening = false;
            }, 2000);
            
        }, 3000); 
    }

    // --- Fun√ß√µes de Ajuda de Data ---
    function formatDate(date) {
        const d = new Date(date);
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        return `${day}/${month}/${year}`;
    }

    function addWorkdays(date, days) {
        let count = 0;
        let d = new Date(date);
        while (count < days) {
            d.setDate(d.getDate() + 1);
            if (d.getDay() !== 0 && d.getDay() !== 6) {
                count++;
            }
        }
        return d;
    }

    // --- Inicializa√ß√£o de Datas ---
    const today = new Date();
    const dataConversa = new Date(today);
    dataConversa.setDate(today.getDate() + 1); 
    const dataPagamento = addWorkdays(dataConversa, 10); 
    const dataBloqueioTI = new Date(dataConversa);
    dataBloqueioTI.setHours(dataBloqueioTI.getHours() + 2); 

    // --- 1. Checklist Inteligente (com Push Effect) ---
    
    function showChecklistConfig() {
        const config = document.getElementById('checklist-config');
        const tasks = document.getElementById('checklist-tasks-area');
        
        // Esconde tarefas
        tasks.style.opacity = '0';
        setTimeout(() => {
            tasks.style.display = 'none';
            // Mostra configura√ß√£o com fade-in
            config.style.display = 'block';
            setTimeout(() => {
                config.style.opacity = '1';
            }, 10);
        }, 500); 
    }
    
    function generateChecklist(isInitialLoad = false, isPreview = false) {
        const nome = document.getElementById('colaboradora-nome').value || "Colaboradora";
        const tipo = document.getElementById('tipo-demissao').value;
        const checklistArea = document.getElementById('checklist-tasks');
        
        let tasks = [];
        
        // Datas espec√≠ficas para o fluxo
        const dataAviso = new Date(today);
        const dataEntrevista = addWorkdays(dataConversa, 2);
        const dataBloqueioTiImediato = new Date(); 
        dataBloqueioTiImediato.setHours(dataBloqueioTiImediato.getHours() + 1);

        // 1. Base Tasks (Comuns)
        tasks.push({ text: `Notificar Gestor Imediato (RH)`, date: formatDate(dataAviso), status: 'concluido' });
        
        // 2. Tarefas Espec√≠ficas por Tipo
        if (tipo === 'performance' || tipo === 'voluntario') {
            tasks.push({ text: `Reuni√£o de Comunica√ß√£o (Gestor + RH)`, date: formatDate(dataConversa), status: 'pendente' });
            tasks.push({ text: `Bloqueio de Acessos de ${nome} (Notificar TI)`, date: formatDate(dataBloqueioTI), status: 'pendente', alert: true });
        }

        if (tipo === 'justa') {
            tasks.push({ text: `Reuni√£o de Comunica√ß√£o de Justa Causa (IMEDIATA)`, date: formatDate(today), status: 'pendente', style: 'danger' });
            tasks.push({ text: `**BLOQUEIO IMEDIATO** de Todos os Sistemas de ${nome} (TI)`, date: formatDate(dataBloqueioTiImediato), status: 'pendente', alert: true, style: 'danger' });
        }
        
        // 3. Tarefas P√≥s-Comunica√ß√£o
        tasks.push({ text: `Coleta de Documentos (Termo de Rescis√£o e Exames)`, date: formatDate(addWorkdays(dataConversa, 1)), status: 'pendente' });

        if (tipo === 'performance' || tipo === 'voluntario') {
             tasks.push({ text: `Gera√ß√£o e Envio da Carta de Recomenda√ß√£o`, date: formatDate(addWorkdays(dataConversa, 3)), status: 'pendente' });
        }
        
        tasks.push({ text: `Entrevista de Sa√≠da com ${nome} (Pesquisa de Sa√≠da)`, date: formatDate(dataEntrevista), status: 'pendente' });
        tasks.push({ text: `Pagamento de Verbas Rescis√≥rias (Prazo de 10 dias √∫teis)`, date: formatDate(dataPagamento), status: 'pendente', alert: true, style: 'danger' });
        
        // 4. Atualizar Datas e Status em Outras Abas (Sempre)
        document.getElementById('data-conversa-prevista').textContent = formatDate(dataConversa);
        document.getElementById('data-pagamento-prevista').textContent = formatDate(dataPagamento);
        document.getElementById('data-bloqueio-ti').textContent = formatDate(dataBloqueioTI) + " (2 horas ap√≥s a reuni√£o)";

        // 5. Renderizar HTML
        let html = tasks.map(task => {
            const badgeClass = task.status === 'concluido' ? 'status-concluido' : (task.style === 'danger' ? 'status-pendente' : 'status-andamento');
            const itemClass = task.status === 'concluido' ? 'status-concluido' : (task.style === 'danger' ? 'status-pendente' : '');
            const alertIcon = task.alert ? '<i class="fas fa-bell" style="color: var(--danger-color); margin-right: 5px;"></i>' : '';

            return `
                <div class="checklist-item ${itemClass}">
                    <div>${alertIcon} ${task.text}</div>
                    <div>
                        <span style="font-size: 0.8em; margin-right: 15px;">Prazo: ${task.date}</span>
                        <span class="status-badge ${badgeClass}">${task.status.toUpperCase()}</span>
                    </div>
                </div>
            `;
        }).join('');
        checklistArea.innerHTML = html;
        
        // 6. Transi√ß√£o (Simulated "push") - Somente se n√£o for a carga inicial ou pr√©-visualiza√ß√£o
        if (!isInitialLoad && !isPreview) {
            const config = document.getElementById('checklist-config');
            const tasks = document.getElementById('checklist-tasks-area');

            config.style.opacity = '0';
            setTimeout(() => {
                config.style.display = 'none';
                tasks.style.display = 'block';
                setTimeout(() => {
                    tasks.style.opacity = '1';
                    
                    // Altera a aba ativa visualmente para a de checklist
                    var tabContents = document.getElementsByClassName("tab-content");
                    for (var i = 0; i < tabContents.length; i++) {
                        tabContents[i].classList.remove("active");
                    }
                    var tabButtons = document.getElementsByClassName("tab-button");
                    for (var i = 0; i < tabButtons.length; i++) {
                        tabButtons[i].classList.remove("active");
                    }
                    document.getElementById('checklist').classList.add("active");
                    document.querySelector(`.sidebar button[onclick*="'checklist'"]`).classList.add("active");
                    
                }, 50);
            }, 500); 
            
            // Re-executa o updateBlocking para o caso de ter mudado para justa causa
            if (tipo === 'justa') {
                simulateBlocking(true); 
            } else {
                simulateBlocking(false, true); 
            }
        }
    }

    // --- 2. Fun√ß√µes de Controle de Abas (Tabs) ---
    function openTab(evt, tabId) {
        var tabContents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < tabContents.length; i++) {
            tabContents[i].classList.remove("active");
        }

        var tabButtons = document.getElementsByClassName("tab-button");
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove("active");
        }

        document.getElementById(tabId).classList.add("active");
        
        // Adiciona classe 'active' ao bot√£o (se o evento for v√°lido)
        if (evt && evt.currentTarget) {
            evt.currentTarget.classList.add("active");
        } else {
            // Se chamado sem evento (ex: via comando de voz ou do chat), encontra o bot√£o
            const buttonToActivate = document.querySelector(`.sidebar button[onclick*="'${tabId}'"]`);
            if (buttonToActivate) {
                buttonToActivate.classList.add('active');
            }
        }
        
        // Se voltar para a aba de checklist, garantir que a configura√ß√£o esteja vis√≠vel
        if (tabId === 'checklist') {
            showChecklistConfig();
        }
    }

    function openTabWithSound(evt, tabId) {
        document.getElementById('alertSound').play();
        openTab(evt, tabId);
    }
    
    // --- NOVO: L√ìGICA DO CHATBOT ---
    
    // ** NOVA FUN√á√ÉO PARA CLIQUE R√ÅPIDO **
    function quickReply(question) {
        document.getElementById('chat-input').value = question;
        sendChatMessage();
    }
    // **********************************

    function appendMessage(sender, text, isAI = false) {
        const chatWindow = document.getElementById('chat-window');
        const msgDiv = document.createElement('div');
        
        msgDiv.style.textAlign = isAI ? 'left' : 'right';
        msgDiv.style.marginBottom = '10px';
        msgDiv.classList.add(isAI ? 'chat-message-ai' : 'chat-message-user');
        
        const content = document.createElement('span');
        content.style.display = 'inline-block';
        content.style.padding = '10px 15px';
        content.style.borderRadius = '15px';
        content.style.maxWidth = '80%';
        content.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
        
        content.innerHTML = isAI ? `<i class="fas fa-robot"></i> **ExitCare IA:** ${text}` : text;
        
        msgDiv.appendChild(content);
        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll
    }

    function initialChatWelcome() {
        // Limpa mensagens anteriores
        document.getElementById('chat-window').innerHTML = '';
        setTimeout(() => {
            appendMessage(null, "Ol√°! Sou o ExitCare IA, seu assistente de offboarding. Use as sugest√µes abaixo ou digite sua pergunta.", true);
        }, 500);
    }
    
    function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (message === "") return;

        // 1. User message
        appendMessage(null, message, false);
        input.value = ''; // Clear input

        // 2. Simulate AI typing delay
        setTimeout(() => {
            let response = "Desculpe, n√£o consegui encontrar uma resposta espec√≠fica para essa pergunta. Tente reformular ou clique em um dos atalhos.";
            const lowerMsg = message.toLowerCase();
            
            // Check for keywords and provide contextual, data-driven answers
            if (lowerMsg.includes("prazo") && lowerMsg.includes("rescis√£o")) {
                const nome = document.getElementById('colaboradora-nome').value || "colaboradora";
                const dataPagamentoStr = document.getElementById('data-pagamento-prevista').textContent;
                response = `O prazo legal para o pagamento das verbas rescis√≥rias da ${nome} √©: **${dataPagamentoStr}** (10 dias √∫teis ap√≥s o fim do contrato/aviso). Verifique a aba Documentos Legais para o Termo.`;
            } else if (lowerMsg.includes("checklist") || lowerMsg.includes("come√ßar") || lowerMsg.includes("gerar")) {
                const nome = document.getElementById('colaboradora-nome').value || "Colaboradora";
                
                if (lowerMsg.includes("ti") || lowerMsg.includes("tecnico")) {
                    // Resposta espec√≠fica para TI checklist
                    response = "O checklist de TI (Bloqueio de Acessos e Devolu√ß√£o de Ativos) √© gerado automaticamente, mas a confirma√ß√£o deve ser manual. Acesse a aba **TI - Desligamento T√©cnico** e clique em 'SIMULAR BLOQUEIO IMEDIATO' ap√≥s a comunica√ß√£o para confirmar o processo. Deseja ir para l√°? <button onclick='openTab(null, \"ti-integracao\")' class='primary' style='padding: 5px 10px; font-size: 0.9em; margin-left: 10px; background-color: var(--accent-color);'>Ir para TI</button>";
                } else {
                    // Resposta geral de checklist
                    response = `Para iniciar um novo offboarding, utilize o bot√£o na aba Checklist Operacional. Ele gera automaticamente os passos e prazos com base no tipo de demiss√£o. Deseja que eu gere o Checklist para a ${nome}? <button onclick='generateChecklist(false, false); openTab(null, "checklist")' class='primary' style='padding: 5px 10px; font-size: 0.9em; margin-left: 10px; background-color: var(--accent-color);'>Gerar Agora</button>`;
                }

            } else if (lowerMsg.includes("documento") || lowerMsg.includes("carta")) {
                response = "Sim, voc√™ pode gerar o Termo de Rescis√£o e a Carta de Recomenda√ß√£o (se aplic√°vel) diretamente na aba **Documentos Legais**.";
            } else if (lowerMsg.includes("ol√°") || lowerMsg.includes("oi")) {
                response = "Ol√°! Sou o ExitCare IA, seu assistente de offboarding. Como posso te ajudar hoje com o processo de desligamento?";
            } else if (lowerMsg.includes("justa causa")) {
                response = "Em casos de Justa Causa, o bloqueio de TI deve ser **IMEDIATO**, e o pagamento de rescis√£o inclui apenas saldo de sal√°rio e f√©rias vencidas. A Carta de Recomenda√ß√£o N√ÉO deve ser emitida.";
            }

            appendMessage(null, response, true);
        }, 1000); // 1 second delay for AI response
    }
    
    // --- FIM DA L√ìGICA DO CHATBOT ---


    // --- 3. Simula√ß√£o de Documento Legal ---
    function generateDocument(docType) {
        const nome = document.getElementById('nome-documento').value;
        const tipo = document.getElementById('tipo-demissao').value;
        const dataPagamentoStr = document.getElementById('data-pagamento-prevista').textContent;
        const previewArea = document.getElementById('document-preview-area');
        
        const recommenderName = document.getElementById('recommender-name').value || 'O Setor de Recursos Humanos'; 
        const performanceRating = document.getElementById('performance-rating').value; 

        let content = '';
        let borderColor = '';
        
        if (docType === 'rescisao') {
            const tipoTexto = tipo === 'justa' ? 'Justa Causa' : (tipo === 'voluntario' ? 'Pedido de Demiss√£o' : 'Decis√£o da Empresa (Sem Justa Causa)');
            borderColor = `var(--accent-color)`;

            content = `
                <h4 style="text-align: center;">TERMO DE RESCIS√ÉO DE CONTRATO DE TRABALHO (TRCT)</h4>
                <p><strong>Empregada:</strong> ${nome}</p>
                <p><strong>Motivo do Desligamento:</strong> ${tipoTexto}</p>
                <p><strong>Data Prevista para Pagamento:</strong> ${dataPagamentoStr}</p>
                <hr style="border-color: var(--bg-light);">
                <p>
                Pelo presente, a EMPREGADORA informa a ${nome} sobre o encerramento do contrato de trabalho por ${tipoTexto}.
                Todos os valores rescis√≥rios ser√£o creditados na conta banc√°ria da empregada dentro do prazo legal de 10 (dez) dias corridos, contados a partir do t√©rmino do aviso pr√©vio (ou da comunica√ß√£o imediata, conforme o caso).
                </p>
                <p style="margin-top: 20px; text-align: right; font-style: italic;">Assinado Eletronicamente por RH e Gestor.</p>
            `;
            
        } else if (docType === 'recomendacao') {
            
            let performanceText = '';
            if (performanceRating === 'excelente') {
                performanceText = 'uma colaboradora **excepcional e de alto desempenho**. Suas contribui√ß√µes foram cruciais para o crescimento de nossa √°rea.';
                borderColor = `var(--primary-color)`;
            } else if (performanceRating === 'bom') {
                performanceText = 'uma profissional dedicada, que cumpriu suas responsabilidades com grande empenho e compet√™ncia t√©cnica.';
                borderColor = `var(--accent-color)`;
            } else { 
                performanceText = 'uma profissional que cumpriu o per√≠odo de contrato com pontualidade e formalidade em suas fun√ß√µes.';
                borderColor = `var(--info-color)`;
            }

            if (tipo === 'justa') {
                content = `<h4 style="color: var(--danger-color); text-align: center;">ALERTA: Carta de Recomenda√ß√£o N√ÉO PODE ser emitida em casos de Justa Causa.</h4>
                           <p>O tipo de desligamento atual (Justa Causa) n√£o permite a emiss√£o deste documento, por pol√≠tica interna e risco legal. O documento n√£o ser√° gerado.</p>`;
                borderColor = `var(--danger-color)`;
            } else {
                content = `
                    <h4 style="text-align: center; color: ${borderColor};">CARTA DE RECOMENDA√á√ÉO</h4>
                    <p style="margin-bottom: 20px;">**√Ä Quem Possa Interessar,**</p>
                    <p>
                    A ExitCare Pro atesta que ${nome} trabalhou em nossa organiza√ß√£o de [Data de In√≠cio] a ${formatDate(today)}, ocupando o cargo de [Cargo]. 
                    Durante seu per√≠odo conosco, ${nome} demonstrou ser ${performanceText}
                    </p>
                    <p>Recomendamos ${nome} para futuras oportunidades, com base em seu desempenho, e desejamos grande sucesso em sua jornada profissional.</p>
                    <p style="margin-top: 20px; text-align: right; font-style: italic;">Atenciosamente, <br> ${recommenderName}</p>
                `;
            }
        }

        previewArea.innerHTML = content;
        
        previewArea.style.border = `2px solid ${borderColor}`;
        setTimeout(() => previewArea.style.border = `1px solid var(--bg-light)`, 1500);
        
        if (docType === 'recomendacao' && tipo !== 'justa') {
            document.getElementById('alertSound').play(); 
        } else if (docType === 'recomendacao' && tipo === 'justa') {
             document.getElementById('alertSound').play(); 
        }
    }

    // --- 4. TI - Desligamento T√©cnico ---
    function simulateBlocking(isJustaCausa = false, reset = false) {
        const list = document.getElementById('system-access-list');
        const button = document.querySelector('#ti-integracao .primary');
        const alertColor = isDarkMode ? 'rgba(227, 126, 134, 0.2)' : 'rgba(220, 53, 69, 0.08)';

        if (reset) {
             list.classList.add('ti-alert-blocker');
             list.style.border = `3px dashed var(--danger-color)`;
             list.style.backgroundColor = alertColor;
             button.textContent = "SIMULAR BLOQUEIO IMEDIATO";
             button.style.animation = 'pulse-red 1s infinite alternate';
             list.innerHTML = `
                <div class="system-status"><span><i class="fas fa-user-lock"></i> Acesso Email/Drive</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
                <div class="system-status"><span><i class="fas fa-users-cog"></i> Acesso CRM/ERP</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
                <div class="system-status"><span><i class="fas fa-code-branch"></i> Acesso Code Repo</span> <span style="color: var(--danger-color);">PENDENTE</span></div>
            `;
             return;
        }

        list.classList.remove('ti-alert-blocker');
        list.style.border = `3px solid var(--accent-color)`;
        list.style.backgroundColor = isDarkMode ? 'rgba(92, 184, 92, 0.2)' : 'rgba(40, 167, 69, 0.08)';
        button.textContent = "BLOQUEIO CONCLU√çDO COM SUCESSO";
        button.style.animation = 'none';

        list.innerHTML = `
            <div class="system-status"><span><i class="fas fa-user-lock"></i> Acesso Email/Drive</span> <span style="color: var(--accent-color);">BLOQUEADO</span></div>
            <div class="system-status"><span><i class="fas fa-users-cog"></i> Acesso CRM/ERP</span> <span style="color: var(--accent-color);">BLOQUEADO</span></div>
            <div class="system-status"><span><i class="fas fa-code-branch"></i> Acesso Code Repo</span> <span style="color: var(--accent-color);">BLOQUEADO</span></div>
        `;
        
        if (isJustaCausa) {
            document.getElementById('alertSound').play();
        }
    }

    function toggleDevolutionStatus(iconElement, currentStatus) {
        if (currentStatus === 'pendente') {
            iconElement.classList.remove('fa-times-circle');
            iconElement.classList.add('fa-check-circle');
            iconElement.style.color = 'var(--accent-color)';
            iconElement.onclick = function() { toggleDevolutionStatus(this, 'concluido'); };
        } else {
            iconElement.classList.remove('fa-check-circle');
            iconElement.classList.add('fa-times-circle');
            iconElement.style.color = 'var(--danger-color)';
            iconElement.onclick = function() { toggleDevolutionStatus(this, 'pendente'); };
        }
    }

    // --- 5. Pesquisa de Sa√≠da e Gr√°ficos ---
    function updateCharts() {
        const satisfacaoInput = document.querySelector('input[name="exp_geral"]:checked');
        const liderancaInput = document.querySelector('input[name="motivo_lideranca"]:checked');
        
        if (!satisfacaoInput || !liderancaInput) return;

        const satisfacaoScore = parseInt(satisfacaoInput.value);
        const liderancaImpacto = liderancaInput.value === 'sim';
        
        let newAvg = 3.5;
        let newBarWidth = '70%'; 
        
        if (satisfacaoScore === 5) { newAvg = 3.8; newBarWidth = '76%'; } 
        else if (satisfacaoScore === 3) { newAvg = 3.3; newBarWidth = '66%'; } 
        else if (satisfacaoScore === 1) { newAvg = 3.0; newBarWidth = '60%'; }

        const barSatisfacao = document.getElementById('bar-satisfacao');
        barSatisfacao.style.width = newBarWidth;
        barSatisfacao.textContent = newAvg.toFixed(1);
        document.getElementById('current-avg').textContent = newAvg.toFixed(1);

        let remPerc = 45;
        let lidPerc = 25;
        let culPerc = 30;
        
        if (liderancaImpacto) {
            lidPerc = 40; 
            remPerc = 35; 
            culPerc = 25; 
        } else {
            lidPerc = 25;
            remPerc = 45; 
            culPerc = 30;
        }

        const pieChart = document.getElementById('pie-chart-area');
        const lidStart = remPerc; 
        const culStart = remPerc + lidPerc; 

        pieChart.style.background = `conic-gradient(
            var(--primary-color) 0% ${lidStart}%, 
            var(--secondary-color) ${lidStart}% ${culStart}%, 
            var(--accent-color) ${culStart}% 100%
        )`;
    }
    
    // --- 6. Indicadores Interativos (KPI) ---
    let turnoverState = 0; 

    function toggleTurnoverRate() {
        const title = document.getElementById('turnover-title');
        const value = document.getElementById('turnover-value');
        const bar = document.getElementById('turnover-bar');
        
        turnoverState = (turnoverState + 1) % 3; 

        switch (turnoverState) {
            case 0:
                title.textContent = "TAXA DE TURNOVER (SEMANAL)";
                value.textContent = "0.8%";
                bar.style.width = "80%";
                bar.style.backgroundColor = "var(--danger-color)";
                break;
            case 1:
                title.textContent = "TAXA DE TURNOVER (MENSAL)";
                value.textContent = "3.2%";
                bar.style.width = "64%";
                bar.style.backgroundColor = "var(--secondary-color)";
                break;
            case 2:
                title.textContent = "TAXA DE TURNOVER (ANUAL)";
                value.textContent = "28%";
                bar.style.width = "95%";
                bar.style.backgroundColor = "var(--danger-color)";
                break;
        }
    }
    
    let exitCostState = 0; 

    function toggleExitCostBreakdown() {
        const title = document.getElementById('exit-cost-title');
        const value = document.getElementById('exit-cost-value');
        const subtitle = document.getElementById('exit-cost-subtitle');
        const kpiBox = document.getElementById('kpi-exit-cost-interactive');

        exitCostState = (exitCostState + 1) % 4; 

        switch (exitCostState) {
            case 0:
                title.textContent = "CUSTO M√âDIO DE SA√çDA (Por Colab.)";
                value.textContent = "R$ 7.850";
                subtitle.innerHTML = "Inclui rescis√£o, contrata√ß√£o e tempo de vac√¢ncia. <br> Clique para ver o detalhamento.";
                value.style.color = "var(--info-color)";
                kpiBox.style.borderLeftColor = "var(--info-color)";
                break;
            case 1:
                title.textContent = "COMPONENTE 1: CUSTOS RESCIS√ìRIOS";
                value.textContent = "R$ 4.200";
                subtitle.innerHTML = "<i class='fas fa-money-bill-wave'></i> Representa 53% do custo total.";
                value.style.color = "var(--danger-color)";
                kpiBox.style.borderLeftColor = "var(--danger-color)";
                break;
            case 2:
                title.textContent = "COMPONENTE 2: CUSTOS DE CONTRATA√á√ÉO";
                value.textContent = "R$ 2.100";
                subtitle.innerHTML = "<i class='fas fa-user-plus'></i> Representa 27% (An√∫ncios, Recrutamento).";
                value.style.color = "var(--primary-color)";
                kpiBox.style.borderLeftColor = "var(--primary-color)";
                break;
            case 3:
                title.textContent = "COMPONENTE 3: TEMPO DE VAC√ÇNCIA (Perda)";
                value.textContent = "R$ 1.550";
                subtitle.innerHTML = "<i class='fas fa-clock'></i> Representa 20% (Perda de produtividade at√© substitui√ß√£o).";
                value.style.color = "var(--accent-color)";
                kpiBox.style.borderLeftColor = "var(--accent-color)";
                break;
        }
    }

    // --- 7. A√ß√£o Sugerir Treinamento (Adicionada no passo anterior) ---
    function suggestTraining() {
        alert('A sugest√£o de treinamento para os gestores (Ana Souza e Pedro Lima) foi enviada para o time de Desenvolvimento Humano (DH) com prioridade.');
    }

    // Inicializa o dashboard (depois do login)
</script>
</body>
</html>